import{u as te,a as o,W as X,B as h,X as ae,Y as m,j as e,L as Y,Z as G,S as re,_ as se,$ as le,T as ne,x as oe,c as de,d as ce,t as ie,b as me}from"./index-CR2cQI6u.js";const ge=()=>{var W,V;const{user:a}=te(),[j,v]=o.useState([]),[D,I]=o.useState([]),[n,b]=o.useState(null),[M,C]=o.useState(!0),[c,f]=o.useState(null),[g,L]=o.useState(""),[S,H]=o.useState(""),[F,J]=o.useState(""),[R,$]=o.useState(null),[K,U]=o.useState(!1),[A,q]=o.useState(null),[u,k]=o.useState(""),x=[{key:"photograph",label:"Photograph",required:!0,icon:ae,accept:"image/*"},{key:"tenthMarksheet",label:"10th Marksheet",required:!0,icon:m,accept:".pdf,.jpg,.jpeg,.png"},{key:"twelfthMarksheet",label:"12th Marksheet",required:!0,icon:m,accept:".pdf,.jpg,.jpeg,.png"},{key:"bachelorDegree",label:"Bachelor Degree",required:!0,icon:m,accept:".pdf,.jpg,.jpeg,.png"},{key:"postgraduateDegree",label:"Postgraduate Degree",required:!1,icon:m,accept:".pdf,.jpg,.jpeg,.png"},{key:"aadharCard",label:"Aadhar Card",required:!0,icon:m,accept:".pdf,.jpg,.jpeg,.png"},{key:"panCard",label:"PAN Card",required:!0,icon:m,accept:".pdf,.jpg,.jpeg,.png"},{key:"pcc",label:"Police Clearance Certificate",required:!1,icon:m,accept:".pdf,.jpg,.jpeg,.png"},{key:"resume",label:"Resume",required:!0,icon:m,accept:".pdf,.doc,.docx"},{key:"offerLetter",label:"Offer Letter",required:!0,icon:m,accept:".pdf,.doc,.docx"}];o.useEffect(()=>{_()},[]),o.useEffect(()=>{Q()},[j,g,S,F]);const _=async()=>{try{if(C(!0),(a==null?void 0:a.role)==="Admin"||(a==null?void 0:a.role)==="Manager"||(a==null?void 0:a.role)==="IT Manager"){const t=await X.get("/employees");t.data&&t.data.success&&v(t.data.data||[])}else{const t=await X.get("/employees/user/"+a.id);if(t.data&&t.data.success){const r=t.data.data;v([r]),b(r)}}}catch(t){console.error("Error fetching employees:",t),f("Failed to load employee data"),h.error("Failed to load employee data")}finally{C(!1)}},Q=()=>{let t=[...j];if(g){const r=g.toLowerCase();t=t.filter(l=>l.fullName&&l.fullName.toLowerCase().includes(r)||l.email&&l.email.toLowerCase().includes(r)||l.employeeId&&l.employeeId.toLowerCase().includes(r)||l.department&&l.department.toLowerCase().includes(r))}S&&(t=t.filter(r=>r.department===S)),F&&(t=t.filter(r=>P(r).status===F)),I(t)},P=t=>{const r=t.documents||{},l=x.filter(d=>d.required),s=l.filter(d=>r[d.key]&&r[d.key].filename).length,y=l.length,N=x.filter(d=>r[d.key]&&r[d.key].filename).length,w=Math.round(s/y*100);let i="incomplete";return s===y?i="complete":s>0&&(i="partial"),{status:i,percentage:w,uploadedRequired:s,totalRequired:y,totalUploaded:N,totalDocuments:x.length}},O=(t,r)=>{const s=(t.documents||{})[r.key];return s&&(s.url||s.filename||s.path)?e.jsx(de,{className:"text-green-500"}):r.required?e.jsx(ce,{className:"text-red-500"}):e.jsx(ie,{className:"text-yellow-500"})},B=async(t,r)=>{try{const s=(t.documents||{})[r.key];if(!s)return h.error("Document not found");if(s.webContentLink){window.open(s.webContentLink,"_blank");return}if(s.url){window.open(s.url,"_blank");return}const N=`https://crm-trial-backend.onrender.com/api/api/employees/documents/${s.filename}`,w=localStorage.getItem("token"),i=await fetch(N,{headers:{Authorization:`Bearer ${w}`}});if(!i.ok)throw new Error("Failed to download");const d=await i.blob(),p=document.createElement("a");p.href=window.URL.createObjectURL(d),p.download=`${t.fullName||t.email}_${r.label}_${s.originalName||s.filename}`,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(p.href),h.success(`Downloaded ${r.label}`)}catch(l){console.error("Error downloading document:",l),h.error("Failed to download document")}},z=(t,r)=>{const s=(t.documents||{})[r.key];if(!s)return h.error("Document not found");if(s.url){window.open(s.url,"_blank");return}const N=`https://crm-trial-backend.onrender.com/api/api/employees/documents/${s.filename}`,w=localStorage.getItem("token"),i=window.open();i&&(i.document.write("<p>Loading document...</p>"),fetch(N,{headers:{Authorization:`Bearer ${w}`}}).then(d=>d.blob()).then(d=>{const p=URL.createObjectURL(d);i.location.href=p}).catch(()=>i.close()))},T=async()=>{if(!A||!u||!n){h.error("Please select a file and document type");return}try{$(u);const t=new FormData;t.append(u,A),t.append("fullName",n.fullName),t.append("email",n.email),t.append("role",n.role);const r=await me.updateUserWithDocuments(n._id,t);r.data&&r.data.success&&(h.success("Document uploaded successfully"),U(!1),q(null),k(""),_())}catch(t){console.error("Error uploading document:",t),h.error("Failed to upload document")}finally{$(null)}},E=(t,r)=>{b(t),k(r),U(!0)},ee=()=>[...new Set(j.map(r=>r.department).filter(Boolean))];return M?e.jsx(Y,{children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-lg",children:"Loading documents..."})]})}):e.jsx(Y,{children:e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Document Management"}),((a==null?void 0:a.role)==="Admin"||(a==null?void 0:a.role)==="Manager"||(a==null?void 0:a.role)==="IT Manager")&&e.jsxs("button",{onClick:()=>E(n,""),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center",children:[e.jsx(G,{className:"mr-2"}),"Upload Document"]})]}),c&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-red-700",children:c})}),((a==null?void 0:a.role)==="Admin"||(a==null?void 0:a.role)==="Manager")&&e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-lg shadow-md mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(re,{className:"mr-2"}),"Filters"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Search Employees"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:g,onChange:t=>L(t.target.value),placeholder:"Name, email, employee ID...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Department"}),e.jsxs("select",{value:S,onChange:t=>H(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"All Departments"}),ee().map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Document Status"}),e.jsxs("select",{value:F,onChange:t=>J(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"complete",children:"Complete"}),e.jsx("option",{value:"partial",children:"Partial"}),e.jsx("option",{value:"incomplete",children:"Incomplete"})]})]})]})]}),((a==null?void 0:a.role)==="Admin"||(a==null?void 0:a.role)==="Manager")&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg shadow-md",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(le,{className:"mr-2"}),"Employees (",D.length,")"]})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:D.map(t=>{const r=P(t);return e.jsx("div",{onClick:()=>b(t),className:`p-4 border-b border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-800 ${(n==null?void 0:n._id)===t._id?"bg-blue-50 dark:bg-blue-900/20":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:t.fullName||t.email}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.department," • ",t.role]}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:["ID: ",t.employeeId||"N/A"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-sm font-medium ${r.status==="complete"?"text-green-600":r.status==="partial"?"text-yellow-600":"text-red-600"}`,children:[r.percentage,"%"]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[r.uploadedRequired,"/",r.totalRequired," required"]})]})]})},t._id)})})]})}),e.jsx("div",{className:"lg:col-span-2",children:n?e.jsx(Z,{employee:n,documentTypes:x,getDocumentStatusIcon:O,downloadDocument:B,viewDocument:z,openUploadModal:E,userRole:a==null?void 0:a.role}):e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg shadow-md p-8 text-center",children:[e.jsx(m,{className:"mx-auto text-gray-400 text-6xl mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 dark:text-white mb-2",children:"Select an Employee"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Choose an employee from the list to view their documents"})]})})]}),!["Admin","Manager","IT Manager"].includes(a==null?void 0:a.role)&&n&&e.jsx(Z,{employee:n,documentTypes:x,getDocumentStatusIcon:O,downloadDocument:B,viewDocument:z,openUploadModal:E,userRole:a==null?void 0:a.role,isOwnDocuments:!0}),K&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center bg-blue-600 text-white px-6 py-4 rounded-t-lg",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Upload Document"}),e.jsx("button",{onClick:()=>{U(!1),q(null),k("")},className:"text-white hover:text-gray-200",children:"×"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Document Type"}),e.jsxs("select",{value:u,onChange:t=>k(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"Select document type"}),x.map(t=>e.jsxs("option",{value:t.key,children:[t.label," ",t.required?"(Required)":"(Optional)"]},t.key))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select File"}),e.jsx("input",{type:"file",onChange:t=>q(t.target.files[0]),accept:u?(W=x.find(t=>t.key===u))==null?void 0:W.accept:"*",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"}),u&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Accepted formats: ",(V=x.find(t=>t.key===u))==null?void 0:V.accept]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{U(!1),q(null),k("")},className:"px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:T,disabled:!A||!u||R,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:R?"Uploading...":"Upload"})]})]})]})})]})})},Z=({employee:a,documentTypes:j,getDocumentStatusIcon:v,downloadDocument:D,viewDocument:I,openUploadModal:n,userRole:b,isOwnDocuments:M=!1})=>{const C=a.documents||{};return e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg shadow-md",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:M?"My Documents":`${a.fullName||a.email}'s Documents`}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:[a.department," • ",a.role," • ID: ",a.employeeId||"N/A"]})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 gap-4",children:j.map(c=>{const f=C[c.key],g=f&&f.filename,L=c.icon;return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"text-gray-400 mr-3"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white",children:[c.label,c.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:g?`Uploaded: ${f.originalName||f.filename}`:"Not uploaded"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v(a,c),g&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>I(a,c),className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:"View Document",children:e.jsx(ne,{})}),e.jsx("button",{onClick:()=>D(a,c),className:"p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded",title:"Download Document",children:e.jsx(oe,{})})]}),(b==="Admin"||b==="Manager"||b==="IT Manager")&&e.jsx("button",{onClick:()=>n(a,c.key),className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",title:g?"Replace Document":"Upload Document",children:e.jsx(G,{})})]})]},c.key)})})})]})};export{ge as default};

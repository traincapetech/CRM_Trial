import{a as i,W as j,B as C,j as e,L,S as F,p as R,v as D,d as U,c as P}from"./index-CR2cQI6u.js";const I=()=>{var u,y;const[m,b]=i.useState([]),[f,g]=i.useState(!0),[r,N]=i.useState(null),[d,h]=i.useState({action:"",performedBy:"",status:"",startDate:"",endDate:"",affectedResource:""}),[s,l]=i.useState({page:1,limit:50,total:0,totalPages:0}),[o,v]=i.useState(!1);i.useEffect(()=>{p(),w()},[d,s.page]);const p=async()=>{try{g(!0);const t=new URLSearchParams({page:s.page,limit:s.limit,...d}),a=await j.get(`/logs?${t}`);a.data.success&&(b(a.data.data),l(n=>({...n,total:a.data.total,totalPages:a.data.pagination.totalPages})))}catch(t){C.error("Failed to fetch logs"),console.error("Error fetching logs:",t)}finally{g(!1)}},w=async()=>{try{const t=await j.get("/logs/stats");t.data.success&&N(t.data.data)}catch(t){console.error("Error fetching stats:",t)}},c=t=>{const{name:a,value:n}=t.target;h(x=>({...x,[a]:n})),l(x=>({...x,page:1}))},k=()=>{h({action:"",performedBy:"",status:"",startDate:"",endDate:"",affectedResource:""}),l(t=>({...t,page:1}))},S=t=>new Date(t).toLocaleString(),E=t=>{switch(t){case"SUCCESS":return e.jsx(P,{className:"text-green-500"});case"FAILURE":return e.jsx(U,{className:"text-red-500"});case"WARNING":return e.jsx(D,{className:"text-yellow-500"});default:return null}},A=()=>r!=null&&r.actionStats?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:r.actionStats.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[e.jsx("h3",{className:"font-semibold text-gray-700 dark:text-gray-300",children:t._id}),e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"font-medium",children:t.count})]}),e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Success:"}),e.jsx("span",{children:t.successCount})]}),e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsx("span",{children:"Failure:"}),e.jsx("span",{children:t.failureCount})]})]})]},t._id))}):null;return e.jsx(L,{children:e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Activity Logs"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>v(!o),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[e.jsx(F,{className:"mr-2"}),o?"Hide Filters":"Show Filters"]}),e.jsxs("button",{onClick:p,className:"flex items-center px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:[e.jsx(R,{className:"mr-2"}),"Refresh"]})]})]}),r&&e.jsxs("div",{className:"mb-6 p-4 bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Activity Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900 rounded-lg",children:[e.jsx("div",{className:"text-blue-600 dark:text-blue-300 text-lg font-semibold",children:"Today's Activities"}),e.jsx("div",{className:"text-2xl font-bold",children:r.todayCount})]}),e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900 rounded-lg",children:[e.jsx("div",{className:"text-green-600 dark:text-green-300 text-lg font-semibold",children:"Total Users Active"}),e.jsx("div",{className:"text-2xl font-bold",children:((u=r.topUsers)==null?void 0:u.length)||0})]}),e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900 rounded-lg",children:[e.jsx("div",{className:"text-purple-600 dark:text-purple-300 text-lg font-semibold",children:"Total Actions"}),e.jsx("div",{className:"text-2xl font-bold",children:((y=r.actionStats)==null?void 0:y.reduce((t,a)=>t+a.count,0))||0})]})]})]}),A(),o&&e.jsx("div",{className:"mb-6 p-4 bg-white dark:bg-gray-800 rounded-lg shadow",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Action Type"}),e.jsxs("select",{name:"action",value:d.action,onChange:c,className:"w-full border border-gray-300 rounded-md shadow-sm p-2",children:[e.jsx("option",{value:"",children:"All Actions"}),e.jsx("option",{value:"LOGIN",children:"Login"}),e.jsx("option",{value:"LOGOUT",children:"Logout"}),e.jsx("option",{value:"LEAD_CREATE",children:"Lead Created"}),e.jsx("option",{value:"LEAD_UPDATE",children:"Lead Updated"}),e.jsx("option",{value:"SALE_CREATE",children:"Sale Created"}),e.jsx("option",{value:"SALE_UPDATE",children:"Sale Updated"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),e.jsxs("select",{name:"status",value:d.status,onChange:c,className:"w-full border border-gray-300 rounded-md shadow-sm p-2",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"SUCCESS",children:"Success"}),e.jsx("option",{value:"FAILURE",children:"Failure"}),e.jsx("option",{value:"WARNING",children:"Warning"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Resource Type"}),e.jsxs("select",{name:"affectedResource",value:d.affectedResource,onChange:c,className:"w-full border border-gray-300 rounded-md shadow-sm p-2",children:[e.jsx("option",{value:"",children:"All Resources"}),e.jsx("option",{value:"USER",children:"User"}),e.jsx("option",{value:"LEAD",children:"Lead"}),e.jsx("option",{value:"SALE",children:"Sale"}),e.jsx("option",{value:"EMPLOYEE",children:"Employee"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",name:"startDate",value:d.startDate,onChange:c,className:"w-full border border-gray-300 rounded-md shadow-sm p-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"End Date"}),e.jsx("input",{type:"date",name:"endDate",value:d.endDate,onChange:c,className:"w-full border border-gray-300 rounded-md shadow-sm p-2"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:k,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Reset Filters"})})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Timestamp"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Action"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Resource"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Details"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center",children:"Loading..."})}):m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center",children:"No logs found"})}):m.map(t=>{var a,n;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:S(t.timestamp)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.action}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:((a=t.performedBy)==null?void 0:a.fullName)||((n=t.performedBy)==null?void 0:n.email)||"Unknown"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t.affectedResource}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[E(t.status),e.jsx("span",{className:`ml-2 text-sm ${t.status==="SUCCESS"?"text-green-600 dark:text-green-400":t.status==="FAILURE"?"text-red-600 dark:text-red-400":"text-yellow-600 dark:text-yellow-400"}`,children:t.status})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400",children:e.jsx("div",{className:"max-w-xs overflow-hidden text-ellipsis",children:typeof t.details=="string"?t.details:JSON.stringify(t.details)})})]},t._id)})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 px-4 py-3 border-t border-gray-200 dark:border-gray-700 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>l(t=>({...t,page:t.page-1})),disabled:s.page===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Previous"}),e.jsx("button",{onClick:()=>l(t=>({...t,page:t.page+1})),disabled:s.page===s.totalPages,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Showing"," ",e.jsx("span",{className:"font-medium",children:(s.page-1)*s.limit+1})," ","to"," ",e.jsx("span",{className:"font-medium",children:Math.min(s.page*s.limit,s.total)})," ","of"," ",e.jsx("span",{className:"font-medium",children:s.total})," ","results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsx("button",{onClick:()=>l(t=>({...t,page:t.page-1})),disabled:s.page===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Previous"}),e.jsx("button",{onClick:()=>l(t=>({...t,page:t.page+1})),disabled:s.page===s.totalPages,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Next"})]})})]})]})})]})]})})};export{I as default};
